---
import ExternalLink from './ExternalLink.astro';
import { siteConfig, buildCategoryUrl } from '../config/site';

const { content, lang } = Astro.props;

const qnaSlug =
  lang === 'ko'
    ? siteConfig.discussions.categories.qnaKoSlug
    : siteConfig.discussions.categories.qnaEnSlug;
const bugSlug =
  lang === 'ko'
    ? siteConfig.discussions.categories.bugKoSlug
    : siteConfig.discussions.categories.bugEnSlug;

const qnaUrl = buildCategoryUrl(qnaSlug);
const bugUrl = buildCategoryUrl(bugSlug);
const featureUrl = buildCategoryUrl(siteConfig.discussions.categories.featureSlug);
const announcementsUrl = buildCategoryUrl(siteConfig.discussions.categories.announcementsSlug);

const hasDocs = Boolean(siteConfig.docsBaseUrl);
const hasFaq = Boolean(siteConfig.faqBaseUrl);

const macUrl = siteConfig.download.macosUrl;
const windowsUrl = siteConfig.download.windowsUrl;
const hasMacDownload = Boolean(macUrl);
const hasWindowsDownload = Boolean(windowsUrl);
const useSingleDownload =
  hasMacDownload && hasWindowsDownload && macUrl === windowsUrl;
const singleDownloadUrl = macUrl || windowsUrl;
const primaryDownload = hasMacDownload ? 'mac' : hasWindowsDownload ? 'windows' : null;

const languageToggle =
  lang === 'ko'
    ? { href: '/set-lang/en', label: 'English' }
    : { href: '/set-lang/ko', label: 'ÌïúÍµ≠Ïñ¥' };

const primaryDownloadClass =
  'bg-blue-600 hover:bg-blue-500 text-white px-10 py-4 rounded-xl font-bold text-lg transition shadow-xl shadow-blue-900/30';
const secondaryDownloadClass =
  'border border-gray-700 hover:border-gray-500 text-white px-10 py-4 rounded-xl font-bold text-lg transition';

const featureIconClasses = ['text-blue-500', 'text-purple-500', 'text-green-500'];
---
<div class="relative">
  <header class="fixed top-0 z-50 w-full border-b border-gray-800 bg-[#0d1117]/80 backdrop-blur-md">
    <div class="mx-auto flex h-16 max-w-6xl items-center justify-between px-6">
      <div class="flex items-center gap-8">
        <a href="#download" class="text-2xl font-bold gradient-text">Notaly</a>
        <nav class="hidden gap-6 text-sm font-medium text-gray-400 md:flex">
          <a href="#features" class="nav-link">{content.nav.features}</a>
          <a href="#download" class="nav-link">{content.nav.download}</a>
          {qnaUrl && (
            <ExternalLink href={qnaUrl} class="nav-link text-gray-400 font-medium">
              {content.nav.qna}
            </ExternalLink>
          )}
          {hasDocs && (
            <ExternalLink href={siteConfig.docsBaseUrl} class="nav-link text-gray-400 font-medium">
              {content.nav.docs}
            </ExternalLink>
          )}
          {hasFaq && (
            <ExternalLink href={siteConfig.faqBaseUrl} class="nav-link text-gray-400 font-medium">
              {content.nav.faq}
            </ExternalLink>
          )}
          <ExternalLink href={siteConfig.githubRepoUrl} class="nav-link text-gray-400 font-medium">
            {content.nav.github}
          </ExternalLink>
        </nav>
      </div>
      <div class="flex items-center gap-4">
        <a
          href={languageToggle.href}
          class="rounded-full border border-gray-700 px-3 py-1 text-xs text-gray-400 transition hover:border-gray-500"
        >
          {languageToggle.label}
        </a>
        <a
          href="#download"
          class="rounded-lg bg-blue-600 px-4 py-1.5 text-sm font-bold text-white shadow-lg shadow-blue-900/20 transition hover:bg-blue-500"
        >
          {content.hero.ctaBeta}
        </a>
      </div>
    </div>
    <div class="mx-auto max-w-6xl px-6 pb-4 md:hidden">
      <nav class="flex flex-wrap gap-4 text-xs font-medium text-gray-400">
        <a href="#features" class="nav-link">{content.nav.features}</a>
        <a href="#download" class="nav-link">{content.nav.download}</a>
        {qnaUrl && (
          <ExternalLink href={qnaUrl} class="nav-link text-gray-400 font-medium">
            {content.nav.qna}
          </ExternalLink>
        )}
        {hasDocs && (
          <ExternalLink href={siteConfig.docsBaseUrl} class="nav-link text-gray-400 font-medium">
            {content.nav.docs}
          </ExternalLink>
        )}
        {hasFaq && (
          <ExternalLink href={siteConfig.faqBaseUrl} class="nav-link text-gray-400 font-medium">
            {content.nav.faq}
          </ExternalLink>
        )}
        <ExternalLink href={siteConfig.githubRepoUrl} class="nav-link text-gray-400 font-medium">
          {content.nav.github}
        </ExternalLink>
      </nav>
    </div>
  </header>

  <main class="pt-16">
    <section id="download" class="mx-auto max-w-6xl scroll-mt-24 px-6 pt-24 text-center md:pt-32">
      <div class="mb-8 inline-block rounded-full border border-blue-500/30 bg-blue-900/20 px-4 py-1 text-xs font-bold text-blue-400">
        {content.hero.badge}
      </div>

      <h1 class="hero-title mb-8 text-6xl font-bold gradient-text md:text-8xl">
        {content.hero.title}
      </h1>
      <p class="mb-10 text-2xl font-light leading-tight text-gray-300 md:text-4xl">
        <span>{content.hero.taglineLine1}</span>
        <br class="md:hidden" />
        <span> {content.hero.taglineLine2}</span>
      </p>
      <p class="mx-auto mb-12 max-w-2xl text-lg leading-relaxed text-gray-500 md:text-xl">
        {content.hero.description}
      </p>
      <div class="flex flex-wrap justify-center gap-4">
        {useSingleDownload && singleDownloadUrl && (
          <ExternalLink href={singleDownloadUrl} variant="button" class={primaryDownloadClass}>
            {content.hero.ctaDownload}
          </ExternalLink>
        )}
        {!useSingleDownload && hasMacDownload && (
          <ExternalLink
            href={macUrl}
            variant="button"
            class={primaryDownload === 'mac' ? primaryDownloadClass : secondaryDownloadClass}
          >
            {content.hero.ctaMac}
          </ExternalLink>
        )}
        {!useSingleDownload && hasWindowsDownload && (
          <ExternalLink
            href={windowsUrl}
            variant="button"
            class={primaryDownload === 'windows' ? primaryDownloadClass : secondaryDownloadClass}
          >
            {content.hero.ctaWindows}
          </ExternalLink>
        )}
        <ExternalLink href={siteConfig.githubRepoUrl} variant="button" class={secondaryDownloadClass}>
          {content.hero.ctaGithub}
        </ExternalLink>
      </div>
    </section>

    <section class="mx-auto max-w-5xl px-6 py-12">
      <div class="card grid items-center gap-10 rounded-[2.5rem] p-10 md:grid-cols-2">
        <div class="text-left">
          <h3 class="code-font mb-4 text-sm font-bold text-blue-400 opacity-70">
            {content.scatter.left.title}
          </h3>
          <div class="code-font rounded-2xl border border-gray-800 bg-black p-6 text-xs leading-relaxed text-gray-400 shadow-inner md:text-sm">
            <span class="text-green-500">## Notaly Notes</span><br />
            - Review API <span class="text-purple-400">&#123;type: 'task'&#125;</span><br />
            <br />
            <span class="text-green-500">## Diary</span><br />
            - Buy coffee <span class="text-purple-400">&#123;type: 'task'&#125;</span>
          </div>
        </div>
        <div class="text-left">
          <h3 class="code-font mb-4 text-sm font-bold text-purple-400 opacity-70">
            {content.scatter.right.title}
          </h3>
          <div class="code-font rounded-2xl border border-gray-800 bg-[#0a0c10] p-6 text-xs leading-relaxed text-gray-300 shadow-inner md:text-sm">
            <span class="text-blue-400">query</span> &#123;type: 'task'&#125;<br />
            <hr class="my-3 border-gray-800" />
            <div class="space-y-2">
              ‚óè Review API<br />
              ‚óè Buy coffee
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="features" class="mx-auto max-w-6xl scroll-mt-24 px-6 py-32">
      <h2 class="mb-16 text-center text-3xl font-bold text-gray-200">
        {content.features.title}
      </h2>
      <div class="grid gap-8 md:grid-cols-3">
        {content.features.cards.map((card, index) => (
          <div class="card rounded-3xl p-10">
            <div class={`mb-6 text-3xl ${featureIconClasses[index % featureIconClasses.length]}`}>
              {card.icon}
            </div>
            <h4 class="mb-4 text-xl font-bold">{card.title}</h4>
            <p class="leading-relaxed text-gray-500">{card.copy}</p>
          </div>
        ))}
      </div>
    </section>

    <section class="mx-auto max-w-5xl px-6 py-16">
      <div class="card rounded-3xl p-10">
        <h2 class="mb-4 text-2xl font-bold text-gray-200">{content.beta.title}</h2>
        <p class="leading-relaxed text-gray-500">{content.beta.copy}</p>
        <div class="mt-4 space-y-2 text-sm text-gray-400">
          <p>{content.beta.os}</p>
          <p>{content.beta.updates}</p>
        </div>
      </div>
    </section>

    {hasFaq && (
      <section id="faq" class="mx-auto max-w-5xl scroll-mt-24 px-6 py-16">
        <div class="card flex flex-col items-start justify-between gap-6 rounded-3xl p-8 md:flex-row md:items-center">
          <div>
            <h2 class="text-2xl font-bold text-gray-200">{content.faq.title}</h2>
            <p class="mt-2 text-gray-500">{content.faq.copy}</p>
          </div>
          <ExternalLink
            href={siteConfig.faqBaseUrl}
            variant="button"
            class="border border-gray-700 px-8 py-3 text-sm font-bold text-gray-200 transition hover:border-gray-500"
          >
            {content.faq.cta}
          </ExternalLink>
        </div>
      </section>
    )}

    <section id="qna" class="mx-auto max-w-5xl scroll-mt-24 px-6 py-24 text-center">
      <h2 class="mb-6 text-4xl font-bold text-gray-200">{content.community.title}</h2>
      <p class="mx-auto mb-12 max-w-2xl text-lg text-gray-500">
        {content.community.copy}
      </p>

      <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4">
        {qnaUrl && (
          <ExternalLink
            href={qnaUrl}
            class="card flex flex-col items-center justify-center rounded-2xl p-6 hover:bg-gray-800/50"
          >
            <span class="mb-2 text-2xl">üí¨</span>
            <span class="font-bold">{content.community.qna}</span>
          </ExternalLink>
        )}
        {bugUrl && (
          <ExternalLink
            href={bugUrl}
            class="card flex flex-col items-center justify-center rounded-2xl p-6 hover:bg-gray-800/50"
          >
            <span class="mb-2 text-2xl">üêõ</span>
            <span class="font-bold">{content.community.bug}</span>
          </ExternalLink>
        )}
        {featureUrl && (
          <ExternalLink
            href={featureUrl}
            class="card flex flex-col items-center justify-center rounded-2xl p-6 hover:bg-gray-800/50"
          >
            <span class="mb-2 text-2xl">üí°</span>
            <span class="text-sm font-bold">{content.community.feature}</span>
          </ExternalLink>
        )}
        {announcementsUrl && (
          <ExternalLink
            href={announcementsUrl}
            class="card flex flex-col items-center justify-center rounded-2xl p-6 hover:bg-gray-800/50"
          >
            <span class="mb-2 text-2xl">üì¢</span>
            <span class="font-bold">{content.community.announcements}</span>
          </ExternalLink>
        )}
      </div>
    </section>
  </main>

  <footer class="mt-20 border-t border-gray-900 py-20 text-center text-gray-600">
    <p class="code-font mb-4 text-sm">{content.footer.tagline}</p>
    <p>¬© {new Date().getFullYear()} Notaly Team. All rights reserved.</p>
  </footer>
</div>
